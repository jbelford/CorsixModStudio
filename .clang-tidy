# =============================================================================
# CorsixModStudio â€” clang-tidy configuration
# =============================================================================
#
# This is a legacy ~2006 C++ codebase being incrementally modernized to C++20.
# Checks are curated to find real bugs and encourage gradual modernization
# without drowning in noise from intentional legacy patterns (raw pointers,
# Hungarian notation, C-style arrays, etc.).
#
# Run via command line:
#   .\tools\run-clang-tidy.ps1
#   .\tools\run-clang-tidy.ps1 src/rainman/core/Exception.cpp
#   .\tools\run-clang-tidy.ps1 -Fix
#
# Run via Visual Studio (uses CMakePresets.json vendor settings):
#   cmake --preset tidy && cmake --build --preset tidy-debug
#
# =============================================================================

# ---- Bug-finding & static analysis (high value) ----------------------------
# ---- Targeted modernization (incremental wins) -----------------------------
# ---- Performance (low-hanging fruit) ----------------------------------------

Checks: >
  -*,
  bugprone-*,
    -bugprone-easily-swappable-parameters,
    -bugprone-narrowing-conversions,
  clang-analyzer-*,
  misc-redundant-expression,
  misc-unused-using-decls,
  modernize-concat-nested-namespaces,
  modernize-deprecated-headers,
  modernize-loop-convert,
  modernize-redundant-void-arg,
  modernize-return-braced-init-list,
  modernize-use-auto,
  modernize-use-default-member-init,
  modernize-use-emplace,
  modernize-use-nullptr,
  modernize-use-override,
  modernize-use-using,
  performance-for-range-declaration,
  performance-implicit-conversion-in-loop,
  performance-unnecessary-copy-initialization,
  performance-unnecessary-value-param,
  readability-container-size-empty,
  readability-duplicate-include,
  readability-misleading-indentation,
  readability-redundant-smartptr-get,
  readability-static-accessed-through-instance,

# Treat clang-tidy warnings as warnings, not errors
WarningsAsErrors: ''

# Show diagnostics from our own headers (all subdirectories), not system/vendored
HeaderFilterRegex: 'src/(rainman|cdms)/.*\.h$'

CheckOptions:
  - key:   modernize-use-override.AllowOverrideAndFinal
    value: false
  - key:   modernize-use-auto.MinTypeNameLength
    value: 5
  - key:   modernize-loop-convert.MinConfidence
    value: reasonable
  - key:   modernize-use-default-member-init.UseAssignment
    value: true
